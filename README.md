# 高级文件去重工具

一个功能强大的 C++ 文件去重工具，支持跨文件夹比较和灵活的重复文件处理策略。
特色：优化了传统全部文件计算哈希再比较的方式，减少对文件的读取，速度极快

## 功能特性

- ✅ **智能编码支持** - 自动设置 UTF-8 编码和系统本地化
- ✅ **多种处理模式** - 支持全局模式和单文件夹模式
- ✅ **安全操作** - 提供模拟运行模式，避免误删文件
- ✅ **灵活配置** - 可调整抽样点和抽样大小参数
- ✅ **交互式操作** - 支持手动选择保留文件
- ✅ **详细日志** - 提供详细输出模式便于调试

## 使用方法

### 基本语法

```bash
advanced_dedup [选项] <目录路径>
```

### 参数说明

| 选项 | 简写 | 描述 | 默认值 |
|------|------|------|--------|
| `--dry-run` | `-d` | 模拟运行，不实际删除文件 | `false` |
| `--verbose` | `-v` | 详细输出模式 | `false` |
| `--yes` | `-y` | 自动确认所有操作 | `false` |
| `--mode` | `-m` | 处理模式: `all`(全局) 或 `folder`(单文件夹) | `all` |
| `--no-skip` | `-n` | 不跳过无重复文件的文件夹 | `false` |
| `--points` | `-p` | 设置抽样点数 | `4` |
| `--size` | `-s` | 设置抽样大小(字节) | `4096` |
| `--help` | `-h` | 显示帮助信息 | - |

### 模式说明

- **all 模式**: 在整个目录树中查找重复文件（跨文件夹比较）
- **folder 模式**: 分别在每个文件夹内查找重复文件（不跨文件夹比较）

## 使用示例

### 1. 查看帮助信息
```bash
advanced_dedup -h
```

### 2. 模拟运行测试
```bash
advanced_dedup -d -v C:\test_directory
```

### 3. 全局去重模式
```bash
advanced_dedup -m all -y C:\documents
```

### 4. 自定义抽样参数
```bash
advanced_dedup -p 8 -s 8192 C:\large_files
```

### 5. 详细输出并跳过空文件夹
```bash
advanced_dedup -v -n C:\mixed_content
```

## 交互式操作

程序支持交互式的文件保留方案配置：

### 操作命令

| 命令 | 功能描述 |
|------|----------|
| `组号` | 查看并修改指定组的保留文件 |
| `all` | 对所有组使用自动选择 |
| `auto` | 对当前组使用自动选择 |
| `list` | 显示所有重复组 |
| `done` | 完成自定义配置 |
| `view 组号` | 查看指定组的详细信息 |

### 交互示例

```
🛠️  自定义保留方案
操作说明:
  - 输入组号 (如: 1) 查看并修改该组的保留文件
  - 输入 'all' 对所有组使用自动选择
  - 输入 'auto' 对当前组使用自动选择
  - 输入 'list' 显示所有重复组
  - 输入 'done' 完成自定义
  - 输入 'view 组号' 查看指定组的详细信息

请输入命令 (组号/all/auto/list/done/view): 1

第 1 组重复文件 (3 个文件):
============================================================
  [1] file1.txt
      路径: C:\test\file1.txt
      大小: 1.00 KB, 修改时间: 2024-01-01 10:00:00
  [2] file2.txt  
      路径: C:\test\file2.txt
      大小: 1.00 KB, 修改时间: 2024-01-01 11:00:00
  [3] file3.txt
      路径: C:\test\file3.txt  
      大小: 1.00 KB, 修改时间: 2024-01-01 12:00:00
============================================================
当前保留的文件: [1] 
请输入要保留的文件编号 (多个编号直接输入无间隔数字，如: 123): 13
第 1 组保留方案已更新: [1] [3] 

请输入命令 (组号/all/auto/list/done/view): 2
```

## 错误处理

程序包含完善的错误处理机制：

- ✅ 参数验证和错误提示
- ✅ 目录存在性检查
- ✅ 本地化设置异常捕获
- ✅ 数字参数格式验证
- ✅ 未知选项检测

## 技术特点

1. **编码兼容性**: 自动设置 UTF-8 编码支持中文路径
2. **异常安全**: 使用 try-catch 块处理可能的异常
3. **参数灵活性**: 支持多种组合参数配置
4. **用户友好**: 清晰的提示信息和进度反馈
5. **性能优化**: 可配置的抽样策略平衡准确性和性能

## 注意事项

- 使用 `--dry-run` 参数先进行测试运行
- 在重要数据上操作前建议备份
- 详细模式 (`-v`) 会输出大量信息，适合调试使用
- 自动确认模式 (`-y`) 会跳过所有确认提示，请谨慎使用

## 构建说明

### 依赖要求
- C++17 或更高版本
- 支持 filesystem 标准的编译器
- Windows 平台（使用了 Windows API）

### 编译命令
```bash
g++ -std=c++17 -o advanced_dedup main.cpp -lstdc++fs
```

---

*该工具适用于需要清理重复文件的场景，特别是拥有大量文档、图片或下载文件的用户。*
